<!DOCTYPE html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
  const baseUrl = "http://localhost:8081";
  const token = localStorage.getItem("token");
  const loggedInUserID = parseInt(localStorage.getItem("loggedInUserID"));
  //get productid
  const url = window.location.toString();
  console.log(url);
  const productid = parseInt(url.split("/").slice(-1)[0]);
  axios.get(`${baseUrl}/product/${productid}`)
    .then((response) => {
      const product = response.data;
      $("#name").append(`<h1>${product.name}</h1>
     <p>description: </p>
     <p>${product.description}</p>
     <p>category: ${product.category}</p>
     <p>price: ${product.price}</p>
     `)

    })

    
  axios.get(`${baseUrl}/product/${productid}/reviews`)
    .then((response) => {
      const review = response.data;
      review.forEach(review => {
        $("#posts").append(

          `
       <div class="card" style="margin-top: 2rem;"> 
              <li class="list-group-item">
                <a>${review.username}</a> 
                 <p class="card-text">${review.rating}</p>
                           <p class="card-text">${review.review}</p>
                          
                           </li>   
                       </div>
       
  `
        )
      });
    })
    
     $(document).on("click", "#button", function() {

            const review = $("#input").val();
            const rating =parseInt($("#typeO").val());
            const requestBody = {
                userid: loggedInUserID,
                review:review,
                rating:rating
            };


            alert(loggedInUserID)
            axios.post(`${baseUrl}/product/${productid}/review`, requestBody,{
                 headers: { "Authorization": "Bearer " + token }
             })
                .then((response) => {
                    alert("successful")
                })
                .catch((error) => {
                    console.log(error);
                    if (error.response.status === 400) {
                        alert("Validation failed");
                    } else {
                        alert("Something unexpected went wrong.");
                    }
                });
        });


</script>
<header>
  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">SP-IT</a>
      </div>
      <ul class="nav navbar-nav">
        <li><a href="#">Profile</a></li>
        <li class="active"><a href="#">Product</a></li>
        <li><a href="#">Promotion</a></li>
        <li><a href="#">Page 3</a></li>
      </ul>
</header>

</div>
</nav>
<div id="name" style="padding: 50px;"></div>

<div id="posts" style="padding: 50px; box-shadow: 2cm; border-color: black;">
<form id="create">

    <select class="typeform" id="typeO">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>
<textarea type="text" id="input" name="reviewinput"></textarea><br><br>
<button type="submit" class="btn btn-primary" id="button">Submit</button>


  
</form>





</div>

</html>